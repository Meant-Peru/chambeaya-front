{"ast":null,"code":"import _asyncToGenerator from\"C:/Users/user/Documents/backut/chambeaya-front/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _regeneratorRuntime from\"C:\\\\Users\\\\user\\\\Documents\\\\backut\\\\chambeaya-front\\\\node_modules\\\\@babel\\\\runtime\\\\regenerator\\\\index.js\";import{useDispatch}from'react-redux';import{ADMIN,COMPANY,LOGIN_SUCCESS,POSTULANT,SALES,SESSION,UPDATE_SUCCESS,USER,USER_OR_PASSWORD_NOT_EXISTING}from'../helpers/constants';import{auth}from'../util/auth.service';import{useNavigate}from'react-router-dom';import{signIn,logout}from'../redux/slices/authSlice';import{GetUser,UpdateUser}from'../util/user.service';import{clearLocalStorage,saveLocalStorage}from'../helpers/localStorage';export var useAuth=function useAuth(){var navigate=useNavigate();var dispatch=useDispatch();var startLogin=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(user){var response,_yield$validateToken,status,userGenerico;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return auth(user);case 2:response=_context.sent;console.log({response:response});_context.t0=response.data.message;_context.next=_context.t0===LOGIN_SUCCESS?7:_context.t0===USER_OR_PASSWORD_NOT_EXISTING?24:26;break;case 7:_context.next=9;return validateToken(response.data.data.token);case 9:_yield$validateToken=_context.sent;status=_yield$validateToken.status;userGenerico=_yield$validateToken.user;if(!status){_context.next=23;break;}_context.t1=userGenerico.rol;_context.next=_context.t1===POSTULANT?16:_context.t1===COMPANY?16:_context.t1===SALES?18:_context.t1===ADMIN?20:22;break;case 16:navigate('/myaccount',{replace:true});return _context.abrupt(\"return\");case 18:navigate('/account-sales',{replace:true});return _context.abrupt(\"return\");case 20:navigate('/dashboard',{replace:true});return _context.abrupt(\"return\");case 22:return _context.abrupt(\"return\");case 23:return _context.abrupt(\"return\");case 24:alert('No encontrado');return _context.abrupt(\"return\");case 26:alert('ERROR SERVIDOR');return _context.abrupt(\"return\");case 28:case\"end\":return _context.stop();}}},_callee);}));return function startLogin(_x){return _ref.apply(this,arguments);};}();var validateToken=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(token){var _yield$GetUser,data,user,paylod;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return GetUser(token);case 3:_yield$GetUser=_context2.sent;data=_yield$GetUser.data;console.log('data validateToken',data);user={dataUser:data.dataUser,rol:data.rol};paylod={token:token,user:user};dispatch(signIn(paylod));saveLocalStorage(SESSION,token);saveLocalStorage(USER,user);return _context2.abrupt(\"return\",{status:true,user:user});case 14:_context2.prev=14;_context2.t0=_context2[\"catch\"](0);console.log('[validateToken]',{error:_context2.t0});return _context2.abrupt(\"return\",{status:false,user:{rol:''}});case 18:case\"end\":return _context2.stop();}}},_callee2,null,[[0,14]]);}));return function validateToken(_x2){return _ref2.apply(this,arguments);};}();var startLogout=function startLogout(){clearLocalStorage();dispatch(logout());navigate('/login',{replace:true});};var startUpdateUser=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(data){var resp,_data,user;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return UpdateUser(data);case 2:resp=_context3.sent;if(resp.message===UPDATE_SUCCESS){_data=resp.data;console.log({data:_data});user={dataUser:_data.dataUser,rol:_data.dataUser.rol,id:_data.id};saveLocalStorage(USER,user);alert('Se actualizó correctamente...');}else{alert('ERROR UPDATE');}return _context3.abrupt(\"return\",resp);case 5:case\"end\":return _context3.stop();}}},_callee3);}));return function startUpdateUser(_x3){return _ref3.apply(this,arguments);};}();return{startLogin:startLogin,validateToken:validateToken,startLogout:startLogout,startUpdateUser:startUpdateUser};};","map":{"version":3,"sources":["C:/Users/user/Documents/backut/chambeaya-front/src/hooks/useAuth.tsx"],"names":["useDispatch","ADMIN","COMPANY","LOGIN_SUCCESS","POSTULANT","SALES","SESSION","UPDATE_SUCCESS","USER","USER_OR_PASSWORD_NOT_EXISTING","auth","useNavigate","signIn","logout","GetUser","UpdateUser","clearLocalStorage","saveLocalStorage","useAuth","navigate","dispatch","startLogin","user","response","console","log","data","message","validateToken","token","status","userGenerico","rol","replace","alert","dataUser","paylod","error","startLogout","startUpdateUser","resp","id"],"mappings":"qRAAA,OAASA,WAAT,KAA4B,aAA5B,CACA,OAASC,KAAT,CAAgBC,OAAhB,CAAyBC,aAAzB,CAAwCC,SAAxC,CAAmDC,KAAnD,CAA0DC,OAA1D,CAAmEC,cAAnE,CAAmFC,IAAnF,CAAyFC,6BAAzF,KAA8H,sBAA9H,CACA,OAASC,IAAT,KAAqB,sBAArB,CAEA,OAASC,WAAT,KAA4B,kBAA5B,CACA,OAASC,MAAT,CAAiBC,MAAjB,KAA+B,2BAA/B,CACA,OAASC,OAAT,CAAkBC,UAAlB,KAAoC,sBAApC,CAEA,OAASC,iBAAT,CAA4BC,gBAA5B,KAAoD,yBAApD,CAEA,MAAO,IAAMC,CAAAA,OAAO,CAAG,QAAVA,CAAAA,OAAU,EAAM,CAC5B,GAAMC,CAAAA,QAAQ,CAAGR,WAAW,EAA5B,CACA,GAAMS,CAAAA,QAAQ,CAAGpB,WAAW,EAA5B,CAEA,GAAMqB,CAAAA,UAAU,0FAAG,iBAAOC,IAAP,8LACKZ,CAAAA,IAAI,CAACY,IAAD,CADT,QACZC,QADY,eAElBC,OAAO,CAACC,GAAR,CAAY,CAAEF,QAAQ,CAARA,QAAF,CAAZ,EAFkB,YAGVA,QAAQ,CAACG,IAAT,CAAcC,OAHJ,6BAIZxB,aAJY,iBAwBZM,6BAxBY,0CAK6BmB,CAAAA,aAAa,CAACL,QAAQ,CAACG,IAAT,CAAcA,IAAd,CAAmBG,KAApB,CAL1C,2CAKRC,MALQ,sBAKRA,MALQ,CAKMC,YALN,sBAKAT,IALA,KAOZQ,MAPY,sCAQPC,YAAY,CAACC,GARN,6BAST5B,SATS,kBAUTF,OAVS,kBAaTG,KAbS,kBAgBTJ,KAhBS,qBAWbkB,QAAQ,CAAC,YAAD,CAAe,CAAEc,OAAO,CAAE,IAAX,CAAf,CAAR,CAXa,yCAcbd,QAAQ,CAAC,gBAAD,CAAmB,CAAEc,OAAO,CAAE,IAAX,CAAnB,CAAR,CAda,yCAiBbd,QAAQ,CAAC,YAAD,CAAe,CAAEc,OAAO,CAAE,IAAX,CAAf,CAAR,CAjBa,2HAyBhBC,KAAK,CAAC,eAAD,CAAL,CAzBgB,yCA4BhBA,KAAK,CAAC,gBAAD,CAAL,CA5BgB,wFAAH,kBAAVb,CAAAA,UAAU,4CAAhB,CAiCA,GAAMO,CAAAA,aAAa,2FAAG,kBAAOC,KAAP,kMAEGf,CAAAA,OAAO,CAACe,KAAD,CAFV,sCAEZH,IAFY,gBAEZA,IAFY,CAGpBF,OAAO,CAACC,GAAR,CAAY,oBAAZ,CAAkCC,IAAlC,EACMJ,IAJc,CAIO,CAAEa,QAAQ,CAAET,IAAI,CAACS,QAAjB,CAA2BH,GAAG,CAAEN,IAAI,CAACM,GAArC,CAJP,CAKdI,MALc,CAKL,CAAEP,KAAK,CAAEA,KAAT,CAAgBP,IAAI,CAAJA,IAAhB,CALK,CAMpBF,QAAQ,CAACR,MAAM,CAACwB,MAAD,CAAP,CAAR,CACAnB,gBAAgB,CAACX,OAAD,CAAUuB,KAAV,CAAhB,CACAZ,gBAAgB,CAACT,IAAD,CAAOc,IAAP,CAAhB,CARoB,iCASb,CAAEQ,MAAM,CAAE,IAAV,CAAgBR,IAAI,CAAJA,IAAhB,CATa,+DAWpBE,OAAO,CAACC,GAAR,CAAY,iBAAZ,CAA+B,CAAEY,KAAK,aAAP,CAA/B,EAXoB,iCAYb,CAAEP,MAAM,CAAE,KAAV,CAAiBR,IAAI,CAAE,CAAEU,GAAG,CAAE,EAAP,CAAvB,CAZa,yEAAH,kBAAbJ,CAAAA,aAAa,8CAAnB,CAgBA,GAAMU,CAAAA,WAAW,CAAG,QAAdA,CAAAA,WAAc,EAAM,CACzBtB,iBAAiB,GACjBI,QAAQ,CAACP,MAAM,EAAP,CAAR,CACAM,QAAQ,CAAC,QAAD,CAAW,CAAEc,OAAO,CAAE,IAAX,CAAX,CAAR,CACA,CAJD,CAMA,GAAMM,CAAAA,eAAe,2FAAG,kBAAOb,IAAP,iKACJX,CAAAA,UAAU,CAACW,IAAD,CADN,QACjBc,IADiB,gBAEvB,GAAIA,IAAI,CAACb,OAAL,GAAiBpB,cAArB,CAAqC,CAC5BmB,KAD4B,CACnBc,IADmB,CAC5Bd,IAD4B,CAEpCF,OAAO,CAACC,GAAR,CAAY,CAAEC,IAAI,CAAJA,KAAF,CAAZ,EACMJ,IAH8B,CAGT,CAAEa,QAAQ,CAAET,KAAI,CAACS,QAAjB,CAA2BH,GAAG,CAAEN,KAAI,CAACS,QAAL,CAAcH,GAA9C,CAAmDS,EAAE,CAAEf,KAAI,CAACe,EAA5D,CAHS,CAIpCxB,gBAAgB,CAACT,IAAD,CAAOc,IAAP,CAAhB,CACAY,KAAK,CAAC,+BAAD,CAAL,CACA,CAND,IAMO,CACNA,KAAK,CAAC,cAAD,CAAL,CACA,CAVsB,iCAWhBM,IAXgB,0DAAH,kBAAfD,CAAAA,eAAe,8CAArB,CAcA,MAAO,CACNlB,UAAU,CAAVA,UADM,CAENO,aAAa,CAAbA,aAFM,CAGNU,WAAW,CAAXA,WAHM,CAINC,eAAe,CAAfA,eAJM,CAAP,CAMA,CA/EM","sourcesContent":["import { useDispatch } from 'react-redux';\nimport { ADMIN, COMPANY, LOGIN_SUCCESS, POSTULANT, SALES, SESSION, UPDATE_SUCCESS, USER, USER_OR_PASSWORD_NOT_EXISTING } from '../helpers/constants';\nimport { auth } from '../util/auth.service';\n\nimport { useNavigate } from 'react-router-dom';\nimport { signIn, logout } from '../redux/slices/authSlice';\nimport { GetUser, UpdateUser } from '../util/user.service';\nimport { UserGenerico } from '../interfaces/User';\nimport { clearLocalStorage, saveLocalStorage } from '../helpers/localStorage';\n\nexport const useAuth = () => {\n\tconst navigate = useNavigate();\n\tconst dispatch = useDispatch();\n\n\tconst startLogin = async (user: any) => {\n\t\tconst response = await auth(user);\n\t\tconsole.log({ response });\n\t\tswitch (response.data.message) {\n\t\t\tcase LOGIN_SUCCESS:\n\t\t\t\tconst { status, user: userGenerico } = await validateToken(response.data.data.token);\n\n\t\t\t\tif (status) {\n\t\t\t\t\tswitch (userGenerico.rol) {\n\t\t\t\t\t\tcase POSTULANT:\n\t\t\t\t\t\tcase COMPANY:\n\t\t\t\t\t\t\tnavigate('/myaccount', { replace: true });\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\tcase SALES:\n\t\t\t\t\t\t\tnavigate('/account-sales', { replace: true });\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\tcase ADMIN:\n\t\t\t\t\t\t\tnavigate('/dashboard', { replace: true });\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\tcase USER_OR_PASSWORD_NOT_EXISTING:\n\t\t\t\talert('No encontrado');\n\t\t\t\treturn;\n\t\t\tdefault:\n\t\t\t\talert('ERROR SERVIDOR');\n\t\t\t\treturn;\n\t\t}\n\t};\n\n\tconst validateToken = async (token: string) => {\n\t\ttry {\n\t\t\tconst { data } = await GetUser(token);\n\t\t\tconsole.log('data validateToken', data);\n\t\t\tconst user: UserGenerico = { dataUser: data.dataUser, rol: data.rol };\n\t\t\tconst paylod = { token: token, user };\n\t\t\tdispatch(signIn(paylod));\n\t\t\tsaveLocalStorage(SESSION, token);\n\t\t\tsaveLocalStorage(USER, user);\n\t\t\treturn { status: true, user };\n\t\t} catch (error) {\n\t\t\tconsole.log('[validateToken]', { error });\n\t\t\treturn { status: false, user: { rol: '' } };\n\t\t}\n\t};\n\n\tconst startLogout = () => {\n\t\tclearLocalStorage();\n\t\tdispatch(logout());\n\t\tnavigate('/login', { replace: true });\n\t};\n\n\tconst startUpdateUser = async (data: any) => {\n\t\tconst resp = await UpdateUser(data);\n\t\tif (resp.message === UPDATE_SUCCESS) {\n\t\t\tconst { data } = resp;\n\t\t\tconsole.log({ data });\n\t\t\tconst user: UserGenerico = { dataUser: data.dataUser, rol: data.dataUser.rol, id: data.id };\n\t\t\tsaveLocalStorage(USER, user);\n\t\t\talert('Se actualizó correctamente...');\n\t\t} else {\n\t\t\talert('ERROR UPDATE');\n\t\t}\n\t\treturn resp;\n\t};\n\n\treturn {\n\t\tstartLogin,\n\t\tvalidateToken,\n\t\tstartLogout,\n\t\tstartUpdateUser,\n\t};\n};\n"]},"metadata":{},"sourceType":"module"}